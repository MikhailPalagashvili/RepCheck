sequenceDiagram
    autonumber
    participant User
    participant Mobile as "Mobile App (KMM)"
    participant API as "Backend API (Ktor)"
    participant S3 as "S3 (Video Objects)"
    participant Q as "Queue (SQS/RabbitMQ)"
    participant AI as "AI Video Service"
    participant DB as PostgreSQL

    User->>Mobile: Finish set, record video
    Mobile->>API: Create set + video metadata
    API->>DB: Insert workout/set/video rows (status=pending)

    Mobile->>API: Request presigned upload URL
    API->>S3: Generate presigned URL
    API-->>Mobile: Return presigned URL

    Mobile->>S3: Upload video via presigned URL
    API->>Q: Enqueue AI job `{video_id, s3_key}`
    Q-->>AI: Deliver job

    AI->>S3: Download video (stream/frames)
    AI->>AI: Preprocess + run models (depth, bar path, symmetry)
    AI->>DB: Update ai_feedback + video status=processed

    Mobile->>API: Poll feedback for video_id
    API->>DB: Read ai_feedback
    API-->>Mobile: Return feedback JSON (scores + comments)