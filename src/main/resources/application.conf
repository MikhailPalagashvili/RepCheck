ktor {
  deployment {
    port = ${?PORT}
  }
}

db {
  url = ${?DB_URL}                       // env overrides if present
  user = ${?DB_USER}
  password = ${?DB_PASSWORD}
  driver = ${?DB_DRIVER}
  pool {
    maxPoolSize = ${?DB_POOL_MAX}        # fallback values can be set below
    connectionTimeoutMs = ${?DB_CONN_TIMEOUT_MS}
    maxLifetimeMs = ${?DB_MAX_LIFETIME_MS}
    idleTimeoutMs = ${?DB_IDLE_TIMEOUT_MS}
  }
}

# Local defaults (used when env not set)
db.url = "jdbc:postgresql://localhost:5432/repcheck"
db.user = "postgres"
db.driver = "org.postgresql.Driver"
db.password = "postgres"
db.pool.maxPoolSize = 10
db.pool.connectionTimeoutMs = 2000
db.pool.maxLifetimeMs = 1800000
db.pool.idleTimeoutMs = 600000

# JWT settings
jwt {
  # Provide via env in real deployments
  secret = ${?JWT_SECRET}
  issuer = ${?JWT_ISSUER}
  audience = ${?JWT_AUDIENCE}
  realm = ${?JWT_REALM}
  expiresSeconds = ${?JWT_EXPIRES_SECONDS}
}

# Local dev defaults
jwt.secret = "$(openssl rand -base64 32)"
jwt.issuer = "repcheck"
jwt.audience = "repcheck-app"
jwt.realm = "repcheck-realm"
jwt.expiresSeconds = 900

# AWS Configuration
aws {
  # LocalStack settings
  endpoint = "http://localhost:4566"
  region = "us-east-1"
  accessKey = "test"
  secretKey = "test"

  # S3 Configuration
  s3 {
    bucketName = "workout-videos"
    presignedUrlExpiry = 15m
    endpoint = ${aws.endpoint}
    forcePathStyle = true
  }

  # SQS Configuration
  sqs {
    queueName = "video-processing-queue"
    endpoint = ${aws.endpoint}
    queueUrl = "${aws.endpoint}/000000000000/video-processing-queue"
    deadLetterQueueName = "video-processing-queue-dlq"
    deadLetterQueueUrl = "${aws.endpoint}/000000000000/video-processing-queue-dlq"
    visibilityTimeout = 30s
    maxMessages = 10
    waitTimeSeconds = 20
  }
}