%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#ffd8d8', 'primaryBorderColor': '#ff9e9e'}}}%%
graph TD
%% Clients
    Mobile["ðŸ“± Mobile App (KMM)"]

%% Main Components
    subgraph "RepCheck - AI Workout Analysis"
        API["API Gateway (Ktor)"]
        Auth["ðŸ” Auth Service"]
        WorkoutSvc["ðŸ’ª Workout Service"]
        VideoSvc["ðŸŽ¥ Video Service"]
        AI["ðŸ§  AI Analysis"]
    end

%% Data Stores
    DB[("ðŸ“Š PostgreSQL")]
    S3[("ðŸ’¾ S3 Storage")]
    Q[("ðŸ”„ Queue")]

%% External Services
    Email["ðŸ“§ Email Service"]

%% Mobile Flows
    Mobile -->|1. All Requests| API
    API -->|2. Auth Request| Auth
    Auth -->|JWT| API -->|3. Return Token| Mobile

    Mobile -->|4. Upload Request| API
    API -->|5. Forward to| VideoSvc
    VideoSvc -->|6. Get URL| S3
    API -->|7. Return URL| Mobile
    Mobile -->|8. Upload| S3

    VideoSvc -->|9. Queue| Q
    Q -->|10. Process| AI
    AI -->|11. Store| DB
    AI -->|12. Update| VideoSvc

%% Data Access
    API -->|CRUD| DB
    WorkoutSvc --> DB
    VideoSvc --> DB
    Auth --> DB
    API -.->|Email| Email

%% Styling
    classDef client fill:#f9f,stroke:#333,stroke-width:2px
    classDef service fill:#bbf,stroke:#333,stroke-width:2px
    classDef storage fill:#bfb,stroke:#333,stroke-width:2px
    classDef external fill:#fbb,stroke:#333,stroke-width:2px
    classDef queue fill:#ffd,stroke:#333,stroke-width:2px

    class Mobile client
    class API,Auth,WorkoutSvc,VideoSvc,AI service
    class DB,S3 storage
    class Q queue
    class Email external